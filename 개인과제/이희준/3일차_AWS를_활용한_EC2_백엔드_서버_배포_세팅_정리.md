# AWS를 활용한 EC2 백엔드 서버 배포 정리

## 📌 배포(Deployment)란?

- 서버를 **다른 사용자들이 인터넷을 통해 사용할 수 있게 만드는 것**
- 배포를 하게 되면 고유한 **IP 주소** 또는 **도메인**이 부여되어,
- 다른 컴퓨터에서 해당 주소로 접속 가능

---

## 🖥️ EC2란?

> EC2 (Elastic Compute Cloud) = AWS에서 빌려 쓰는 컴퓨터

- 우리가 직접 컴퓨터를 24시간 켜놓고 서버 운영하기에는 부담이 큼
- 보안상 내 컴퓨터에 외부에서 접근 가능하게 하는 것은 위험
- 따라서 AWS에서 **원격 컴퓨터(EC2 인스턴스)** 를 빌려서 서버를 띄움

### EC2의 장점
- **로깅 (CloudWatch Logs)**: 실시간 로그 수집 및 장애 분석
- **오토스케일링**: 트래픽 변화에 따라 인스턴스 수 자동 조정
- **로드밸런싱**: 여러 인스턴스에 트래픽 분산 → 안정성 확보

---

## 🔐 AWS 계정 구조

### 루트 계정 (Root Account)
- AWS 가입 시 생성되는 **최상위 관리자 계정**
- 결제, 계정 설정 등 중대한 작업에만 사용
- **일상적인 사용에서는 사용 금지** (보안 위험)

### IAM 사용자 (Identity and Access Management)
- 루트 계정 하위에 **다수의 사용자 계정**을 만들 수 있음
- 각 사용자에게 **역할(Role)** 과 **정책(Policy)** 을 설정하여 권한을 최소화
- **최소 권한 원칙**: 필요한 권한만 부여

#### 예시
- `dev-user`: EC2 권한만
- `ops-user`: S3 접근만
- `billing-user`: 결제 정보만 확인 가능

### MFA (Multi-Factor Authentication)
- 계정 보안을 위한 **2단계 인증 필수**

---

## 🔑 액세스 키란?

> 프로그램이나 자동화 스크립트가 AWS에 접근할 때 사용하는 디지털 비밀번호

- 구성: `Access Key ID` + `Secret Access Key`
- 콘솔 접속은 ID/비밀번호, 코드 기반 접속은 **액세스 키** 필요
- **절대 유출 금지**, 필요할 때만 발급 후 안전하게 보관

---

## 🌍 리전(Region) 선택

- AWS는 **지리적 위치별 데이터 센터**를 운영
- 사용자 위치와 가까운 리전을 선택해야 **속도와 응답성 향상**
- 예: 한국 → `ap-northeast-2 (Seoul)`

---

## ⚙️ EC2 인스턴스 세팅 과정

### 1. 이름 및 태그
- 여러 대의 인스턴스 중 구분을 위해 명확한 이름 사용  
  예: `myservice-backend-server`

### 2. OS 이미지 선택 (AMI)
- 운영체제 선택: 일반적으로 **Ubuntu LTS** 선택 (가볍고 배포에 적합)

### 3. 인스턴스 유형
- 사양 설정: CPU, RAM 등
- 프리티어: `t2.micro` 또는 `t3.micro`  
  → **하루 약 2,000명 사용자까지도 충분**

### 4. 키 페어 (Key Pair)
- EC2에 접속할 때 사용하는 **비밀번호 역할**
- `.pem` 파일 다운로드 후 안전하게 보관 (재발급 불가)

### 5. 보안 그룹 설정 (Security Group)
> 일종의 **클라우드 방화벽**. 인스턴스에 접근 가능한 규칙 정의

#### 인바운드 (Inbound): 외부 → EC2  
#### 아웃바운드 (Outbound): EC2 → 외부

허용할 포트 예시:

- **SSH (22번 포트)**: EC2에 원격 접속할 때 사용
- **HTTP (80번 포트)**: 웹 요청을 허용 (예: 웹사이트 접속)
- **HTTPS (443번 포트)**: 보안이 적용된 웹 요청 허용 (SSL/TLS)

> 특정 IP만 허용하고 싶다면?
- 보안 그룹 설정 시 **"사용자 지정(Custom)"**을 선택하고,
- 접속을 허용하고자 하는 **내 IP 주소만 입력**하면 됨

### 6. 포트 개념

| 구분 | 의미 |
|------|------|
| **IP 주소** | 특정 컴퓨터의 주소 (예: 13.250.15.132) |
| **포트 번호** | 한 컴퓨터 내에서 실행 중인 특정 프로그램의 주소 (예: :3000) |

- 외부에서 특정 서버에 접근할 때는 **IP 주소 + 포트 번호**로 구분
- 예: `13.250.15.132:3000` → 해당 IP에 있는 **3000번 포트** 프로그램을 가리킴

#### ❓ 그런데 왜 브라우저에 포트 번호를 안 써도 되지?

- 브라우저는 기본적으로 **80번 포트(HTTP)**, **443번 포트(HTTPS)** 로 통신하도록 설정되어 있음
- 그래서 `https://naver.com` 처럼 입력해도 기본적으로 443번 포트로 접속

> 만약 다른 포트를 사용하고 있다면, 명시적으로 포트 번호를 입력해야 함  
> 예: `http://my-server.com:3000`

#### 🔒 Well-known 포트 번호 (0~1023번)

| 포트 번호 | 용도 |
|-----------|------|
| **22**    | SSH (원격 접속) |
| **80**    | HTTP |
| **443**   | HTTPS |

> 이 포트들은 일반적으로 표준 용도로 정해져 있지만, **꼭 정해진 번호만 써야 하는 것은 아님**

---

### 7. 스토리지 구성 (EBS)

- EC2도 하나의 컴퓨터이므로 **저장 공간(하드디스크)** 이 필요함
- 이 저장공간을 AWS에서는 **EBS (Elastic Block Store)** 라고 부름

#### ✅ 주요 포인트

- **EBS = EC2에 붙이는 하드디스크**
- **스토리지 = 볼륨(Volume)** 이라고도 부름
- 프리티어에서는 **30GB까지 무료 제공**
- **볼륨 타입은 `gp3` 추천** (성능 대비 가격 효율 좋음, `gp2`보다 최신)

> 나머지 옵션은 기본 설정 그대로 두어도 무방

---

## ✅ EC2 세팅 순서 요약

1. AWS 가입 및 루트 계정 보안 설정
2. IAM 사용자 생성 및 권한 설정
3. 액세스 키 생성 및 MFA 적용
4. 리전(Region) 선택 (ex. ap-northeast-2: 서울)
5. EC2 인스턴스 생성
   - OS: Ubuntu LTS
   - 인스턴스 유형: t2.micro (프리티어)
   - 키 페어 생성 및 안전한 보관
   - 보안 그룹: 22, 80, 443 포트 열기
   - 스토리지: 30GB, gp3
6. **SSH를 통해 EC2 원격 접속**
   - `.pem` 키 파일을 이용해 EC2 인스턴스에 접속
   - 예시: `ssh -i my-key.pem ubuntu@<EC2-Public-IP>`

7. **백엔드 애플리케이션 배포 및 테스트**
   - 서버 실행 (예: Spring Boot, Node.js 등)
   - 보안 그룹에서 열어둔 포트(예: 80번)를 통해 접속 테스트

---

## 📌 마무리 팁

- 🔑 **`.pem` 키 파일은 절대 분실 금지**
  - 분실 시 EC2 인스턴스에 다시 접속할 수 없습니다

- 🌐 **EC2 재시작 시 IP 주소 변경됨**
  - 고정 IP가 필요하다면 **Elastic IP**를 할당해 사용하세요

- 🚀 **실서비스 환경에서는 아래 요소를 추가로 고려하세요:**

  - ✅ **HTTPS 인증서 설정**
    - Nginx + Certbot을 이용해 Let’s Encrypt 무료 인증서 적용

  - ✅ **오토스케일링 그룹**
    - 트래픽 증가에 따라 자동으로 인스턴스를 늘려줌

  - ✅ **로드 밸런서(ELB) 구성**
    - 여러 서버에 트래픽을 분산시켜 안정성과 성능 향상
    
---